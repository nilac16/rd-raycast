#include "cmap.h"


static void dose_cmapfn(struct rc_colormap *this, double dose, void *pixel)
{
    static const unsigned char prot[] = {
          0,   0, 255, 255,
          0,   2, 252, 255,
          0,   4, 248, 255,
          0,   6, 244, 255,
          0,   8, 240, 255,
          0,  10, 236, 255,
          0,  12, 232, 255,
          0,  14, 228, 255,
          0,  16, 224, 255,
          0,  18, 220, 255,
          0,  20, 216, 255,
          0,  22, 212, 255,
          0,  24, 208, 255,
          0,  26, 204, 255,
          0,  28, 200, 255,
          0,  30, 196, 255,
          0,  32, 192, 255,
          0,  34, 188, 255,
          0,  36, 184, 255,
          0,  38, 180, 255,
          0,  40, 176, 255,
          0,  42, 172, 255,
          0,  44, 168, 255,
          0,  46, 164, 255,
          0,  48, 160, 255,
          0,  50, 156, 255,
          0,  52, 152, 255,
          0,  54, 148, 255,
          0,  56, 144, 255,
          0,  58, 140, 255,
          0,  60, 136, 255,
          0,  62, 132, 255,
          0,  64, 128, 255,
          0,  66, 124, 255,
          0,  68, 120, 255,
          0,  70, 116, 255,
          0,  72, 112, 255,
          0,  74, 108, 255,
          0,  76, 104, 255,
          0,  78, 100, 255,
          0,  80,  96, 255,
          0,  82,  92, 255,
          0,  84,  88, 255,
          0,  86,  84, 255,
          0,  88,  80, 255,
          0,  90,  76, 255,
          0,  92,  72, 255,
          0,  94,  68, 255,
          0,  96,  64, 255,
          0,  98,  60, 255,
          0, 100,  56, 255,
          0, 102,  52, 255,
          0, 104,  48, 255,
          0, 106,  44, 255,
          0, 108,  40, 255,
          0, 110,  36, 255,
          0, 112,  32, 255,
          0, 114,  28, 255,
          0, 116,  24, 255,
          0, 118,  20, 255,
          0, 120,  16, 255,
          0, 122,  12, 255,
          0, 124,   8, 255,
          0, 126,   4, 255,
          0, 128,   0, 255,
          4, 130,   0, 255,
          8, 132,   0, 255,
         12, 134,   0, 255,
         16, 136,   0, 255,
         20, 138,   0, 255,
         24, 140,   0, 255,
         28, 142,   0, 255,
         32, 144,   0, 255,
         36, 146,   0, 255,
         40, 148,   0, 255,
         44, 150,   0, 255,
         48, 152,   0, 255,
         52, 154,   0, 255,
         56, 156,   0, 255,
         60, 158,   0, 255,
         64, 160,   0, 255,
         68, 162,   0, 255,
         72, 164,   0, 255,
         76, 166,   0, 255,
         80, 168,   0, 255,
         84, 170,   0, 255,
         88, 172,   0, 255,
         92, 174,   0, 255,
         96, 176,   0, 255,
        100, 178,   0, 255,
        104, 180,   0, 255,
        108, 182,   0, 255,
        112, 184,   0, 255,
        116, 186,   0, 255,
        120, 188,   0, 255,
        124, 190,   0, 255,
        128, 192,   0, 255,
        132, 194,   0, 255,
        136, 196,   0, 255,
        140, 198,   0, 255,
        144, 200,   0, 255,
        148, 202,   0, 255,
        152, 204,   0, 255,
        156, 206,   0, 255,
        160, 208,   0, 255,
        164, 210,   0, 255,
        168, 212,   0, 255,
        172, 214,   0, 255,
        176, 216,   0, 255,
        180, 218,   0, 255,
        184, 220,   0, 255,
        188, 222,   0, 255,
        192, 224,   0, 255,
        196, 226,   0, 255,
        200, 228,   0, 255,
        204, 230,   0, 255,
        208, 232,   0, 255,
        212, 234,   0, 255,
        216, 236,   0, 255,
        220, 238,   0, 255,
        224, 240,   0, 255,
        228, 242,   0, 255,
        232, 244,   0, 255,
        236, 246,   0, 255,
        240, 248,   0, 255,
        244, 250,   0, 255,
        248, 252,   0, 255,
        252, 254,   0, 255,
        255, 255,   0, 255,
        255, 254,   0, 255,
        255, 253,   0, 255,
        255, 252,   0, 255,
        255, 251,   0, 255,
        255, 250,   0, 255,
        255, 249,   0, 255,
        255, 248,   0, 255,
        255, 247,   0, 255,
        255, 246,   0, 255,
        255, 245,   0, 255,
        255, 244,   0, 255,
        255, 243,   0, 255,
        255, 242,   0, 255,
        255, 241,   0, 255,
        255, 240,   0, 255,
        255, 239,   0, 255,
        255, 238,   0, 255,
        255, 237,   0, 255,
        255, 236,   0, 255,
        255, 235,   0, 255,
        255, 234,   0, 255,
        255, 233,   0, 255,
        255, 232,   0, 255,
        255, 231,   0, 255,
        255, 230,   0, 255,
        255, 229,   0, 255,
        255, 228,   0, 255,
        255, 227,   0, 255,
        255, 226,   0, 255,
        255, 225,   0, 255,
        255, 224,   0, 255,
        255, 223,   0, 255,
        255, 222,   0, 255,
        255, 221,   0, 255,
        255, 220,   0, 255,
        255, 219,   0, 255,
        255, 218,   0, 255,
        255, 217,   0, 255,
        255, 216,   0, 255,
        255, 215,   0, 255,
        255, 214,   0, 255,
        255, 213,   0, 255,
        255, 212,   0, 255,
        255, 211,   0, 255,
        255, 210,   0, 255,
        255, 209,   0, 255,
        255, 208,   0, 255,
        255, 207,   0, 255,
        255, 206,   0, 255,
        255, 205,   0, 255,
        255, 204,   0, 255,
        255, 203,   0, 255,
        255, 202,   0, 255,
        255, 201,   0, 255,
        255, 200,   0, 255,
        255, 199,   0, 255,
        255, 198,   0, 255,
        255, 197,   0, 255,
        255, 196,   0, 255,
        255, 195,   0, 255,
        255, 194,   0, 255,
        255, 193,   0, 255,
        255, 192,   0, 255,
        255, 192,   0, 255,
        255, 189,   0, 255,
        255, 186,   0, 255,
        255, 183,   0, 255,
        255, 180,   0, 255,
        255, 177,   0, 255,
        255, 174,   0, 255,
        255, 171,   0, 255,
        255, 168,   0, 255,
        255, 165,   0, 255,
        255, 162,   0, 255,
        255, 159,   0, 255,
        255, 156,   0, 255,
        255, 153,   0, 255,
        255, 150,   0, 255,
        255, 147,   0, 255,
        255, 144,   0, 255,
        255, 141,   0, 255,
        255, 138,   0, 255,
        255, 135,   0, 255,
        255, 132,   0, 255,
        255, 129,   0, 255,
        255, 126,   0, 255,
        255, 123,   0, 255,
        255, 120,   0, 255,
        255, 117,   0, 255,
        255, 114,   0, 255,
        255, 111,   0, 255,
        255, 108,   0, 255,
        255, 105,   0, 255,
        255, 102,   0, 255,
        255,  99,   0, 255,
        255,  96,   0, 255,
        255,  93,   0, 255,
        255,  90,   0, 255,
        255,  87,   0, 255,
        255,  84,   0, 255,
        255,  81,   0, 255,
        255,  78,   0, 255,
        255,  75,   0, 255,
        255,  72,   0, 255,
        255,  69,   0, 255,
        255,  66,   0, 255,
        255,  63,   0, 255,
        255,  60,   0, 255,
        255,  57,   0, 255,
        255,  54,   0, 255,
        255,  51,   0, 255,
        255,  48,   0, 255,
        255,  45,   0, 255,
        255,  42,   0, 255,
        255,  39,   0, 255,
        255,  36,   0, 255,
        255,  33,   0, 255,
        255,  30,   0, 255,
        255,  27,   0, 255,
        255,  24,   0, 255,
        255,  21,   0, 255,
        255,  18,   0, 255,
        255,  15,   0, 255,
        255,  12,   0, 255,
        255,   9,   0, 255,
        255,   6,   0, 255,
        255,   3,   0, 255
    };
    const size_t len = sizeof prot / 4;
    struct dose_cmap *cmap = (struct dose_cmap *)this;
    double rel = dose / cmap->dmax;
    int *dst = (int *)pixel;
    const int *src;
    unsigned i;

    i = (unsigned)(rel * (double)(len - 1));
    i = (i < len) ? i : len;
    src = (const int *)prot + i;
    *dst = *src;
}


void dose_cmap_init(struct dose_cmap *cmap, double dosemax)
{
    cmap->base.func = dose_cmapfn;
    cmap->dmax = dosemax;
}
